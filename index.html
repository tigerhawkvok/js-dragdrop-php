<!DOCTYPE html>
<html>
  <head>
    <title>JS Droppbable Test</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="UTF-8"/>
    <meta name="theme-color" content="#445e14"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" type="text/css" media="screen" href="css/main.min.css"/>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/drop-upload.min.js"></script>
    <script type="text/javascript">
      // Generated by CoffeeScript 1.9.3

      /*
      * Test initialization and callback
      */

      (function() {
      var dropTargetSelector, postUploadCallback;

      dropTargetSelector = "#drop-target";

      postUploadCallback = function(file, result) {
      var e, ext, fileName, fullFile, fullPath;
      if (typeof result !== "object") {
      console.error("Dropzone returned an error - " + result);
      toastStatusMessage("<strong>Error</strong> There was a problem with the server handling your image. Please try again.", "danger");
      return false;
      }
      if (result.status !== true) {
      if (result.human_error == null) {
      result.human_error = "There was a problem uploading your image.";
      }
      toastStatusMessage("<strong>Error</strong> " + result.human_error, "danger");
      console.error("Error uploading!", result);
      return false;
      }
      try {
      console.info("Server returned the following result:", result);
      console.info("The script returned the following file information:", file);
      fileName = file.name;
      dropperParams.dropzone.disable();
      ext = fileName.split(".").pop();
      fullFile = (md5(fileName)) + "." + ext;
      fullPath = "" + dropperParams.uploadPath + fullFile;
      d$("#edit-image").attr("disabled", "disabled").attr("value", fullPath);
      toastStatusMessage("Upload complete", "success");
      } catch (_error) {
      e = _error;
      console.error("There was a problem with upload post-processing - " + e.message);
      console.warn("Using", fileName, result);
      toastStatusMessage("<strong>Error</strong> Your upload completed, but we couldn't post-process it.", "danger");
      }
      return false;
      };

      $(function() {
      window.dropperParams.metaPath = "http://velociraptorsystems.com/samples/js-dragdrop-upload/";
      return window.dropperParams.handleDragDropImage(dropTargetSelector, postUploadCallback);
      });

      }).call(this);

    </script>
  </head>
  <body class="container">
    <h1>Uploader Test</h1>
    <main>
      <section class="chat-box form-horizontal">
        <h2>Chat</h2>
        <div id="chat-region" style="min-height: 25vh; border: 1px solid black; ">

        </div>
        <div id="entry-region" class="form-group">
          <label for="new-message">Message:</label>
          <textarea id="new-message" class="message-input form-control" placeholder="Message ..."></textarea>          
          <button type="submit" class="btn btn-default">Send</button>
        </div>
        <div id='drop-target' style='width:15em; height:10em; border: 1px solid black;'></div>
      </section>
    </main>
  </body>
</html>
